<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <header>
  
    <nav>
      <a href="index.html">Back</a>
    </nav>

    <h1>Arrival</h1>
    <p>Prepare for the festival.</p>
  </header>

  <section class="arrival-menu">
    <ul>
      <li><span>Interactive Lineup</span></li>
      <li><a href="#">History (20 Years)</a></li>
      <li><a href="#">Festival Info</a></li>
    </ul>
  <div class="container">
  <div class="controls" id="controls"></div>
    <div class="wrapper" id="map">
  <!-- Axis lines -->
  <div class="axis axis-x"></div>
  <div class="axis axis-y"></div>

  <!-- Axis labels -->
  <div class="axis-label" style="top: 5px; left: 50%; transform: translateX(-50%);">
    ELECTRIC
  </div>
  <div class="axis-label" style="bottom: 5px; left: 50%; transform: translateX(-50%);">
    ORGANIC
  </div>
  <div class="axis-label" style="left: 5px; top: 50%; transform: translateY(-50%);">
    ATMOSPHERIC
  </div>
  <div class="axis-label" style="right: 5px; top: 50%; transform: translateY(-50%);">
    BOUNCY 
  </div>
    </div>

</div>

<!-- D3 force for auto non-overlap -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<script>
const data = [
{ genre: "acid_techno",           x: 4.1,  y: 4.7,  size: 1, family: "Electronic" },
{ genre: "afro_house",            x: 3.5,  y: 2.1,  size: 2, family: "Electronic" },
{ genre: "afrobeats",             x: 3.2,  y: 0.8,  size: 2, family: "Pop"  },
{ genre: "alt-R&B",               x: -3.8, y: -2.1, size: 3,  family: "Pop" },
{ genre: "alt-dance",             x: -0.6, y: -0.2, size: 3 , family: "Pop" },
{ genre: "alt-z",                 x: -0.8, y: -0.4, size: 2 , family: "Pop" },
{ genre: "art_pop",               x: -5.0, y: -1.2, size: 4 , family: "Pop" },
{ genre: "dance_punk",            x: 5.1,  y: -0.1, size: 3 , family: "Rock" },
{ genre: "deep_house",            x: -3.0, y: -1.4, size: 1 , family: "Electronic"},
{ genre: "electropop",            x: 4.4,  y: 1.9,  size: 4 , family: "Pop" },
{ genre: "experimental_electronic", x: 0.8, y: 3.2, size: 4 , family: "Electronic"},
{ genre: "garage_punk",           x: 4.3,  y: -1.8, size: 2 , family: "Rock" },
{ genre: "garage_rock_revival",   x: 1.9,  y: -2.6, size: 2 , family: "Rock" },
{ genre: "hardcore_punk",         x: 4.2,  y: -2.0, size: 2 , family: "Rock" },
{ genre: "hyperpop",              x: 5.0,  y: 3.8,  size: 3 , family: "Pop" },
{ genre: "indie_pop",             x: 0.1,  y: 3.0,  size: 5 , family: "Pop" },
{ genre: "indie_rock",            x: -1.8, y: -2.8, size: 5 , family: "Rock" },
{ genre: "indietronica",          x: -3.2, y: -0.3, size: 2, family: "Pop"  },
{ genre: "k_pop",                 x: 0.7,  y: 0.2,  size: 3 , family: "Pop"},
{ genre: "mainstream_pop",        x: 0.7,  y: -0.3, size: 3 , family: "Pop" },
{ genre: "neo_soul",              x: -2.3, y: -2.3, size: 1 , family: "Pop"},
{ genre: "noise_rock",            x: 2.8,  y: -1.9, size: 3 , family: "Rock" },
{ genre: "organic_house",         x: -3.7, y: -0.8, size: 2, family: "Electronic" },
{ genre: "post_punk_revival",     x: 0.5, y: -1.4,  size: 3 , family: "Rock" },
{ genre: "progressive_techno",    x: -0.8, y: 3.5,  size: 3, family: "Electronic"},
{ genre: "punk_metal",            x: 3.4,  y: -2.9, size: 1, family: "Rock"  },
{ genre: "reggaeton",             x: 2.7,  y: 0.6, size: 1 , family: "Pop" },
{ genre: "tech_house",            x: 1.8,  y: 1.3,  size: 4 , family: "Electronic"},
{ genre: "uk_bass",               x: 0.9,  y: 1.7,  size: 2 , family: "Electronic"},
];

const map = document.getElementById("map");
const width = map.clientWidth;
const height = map.clientHeight;

const originX = width / 2;
const originY = height / 2;

const scale = 60;

// Create tiles
data.forEach(d => {
  d.width = 26 + d.size * 10;
  d.height = 26 + d.size * 10;

  const div = document.createElement("div");
  div.className = "tile";
  div.style.width = d.width + "px";
  div.style.height = d.height + "px";

  div.innerHTML = `
      ${d.genre.replace(/_/g," ")}
      <div class="size-badge">${d.size}</div>
  `;

  map.appendChild(div);
  d.el = div;

  d.xPos = originX + d.x * scale;
  d.yPos = originY - d.y * scale;
});

// Use D3 force simulation
const simulation = d3.forceSimulation(data)
  .force("x", d3.forceX(d => originX + d.x * scale).strength(0.4))
  .force("y", d3.forceY(d => originY - d.y * scale).strength(0.4))
  .force("collide",
    d3.forceCollide(d => Math.sqrt(d.width*d.width + d.height*d.height)/2 + 3)
      .iterations(4)
  )
  .alphaDecay(0.03)
  .on("tick", () => {
    data.forEach(d => {
      d.el.style.left = (d.x - d.width/2) + "px";
      d.el.style.top = (d.y - d.height/2) + "px";
    });
  });
let activeFamily = "All";

const families = Array.from(new Set(data.map(d => d.family))).sort();
const allFamilies = ["All", ...families];

allFamilies.forEach(f => {
  const btn = document.createElement("button");
  btn.className = "filter-btn" + (f === "All" ? " active" : "");
  btn.textContent = f;
  btn.dataset.family = f;
  controls.appendChild(btn);
});

function updateVisibility() {
  data.forEach(d => {
    const show = (activeFamily === "All" || d.family === activeFamily);
    d.el.style.display = show ? "block" : "none";
  });
}

controls.addEventListener("click", (e) => {
  const btn = e.target.closest(".filter-btn");
  if (!btn) return;

  activeFamily = btn.dataset.family;

  // 切换按钮 active 样式
  document
    .querySelectorAll(".filter-btn")
    .forEach(b => b.classList.toggle("active", b === btn));

  updateVisibility();
});

// 初始显示全部
updateVisibility();
</script>
</body>
</html>
